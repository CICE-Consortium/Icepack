
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>4.6. Documentation System &#8212; Icepack 1.0.0 documentation</title>
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="5. Index of primary variables and parameters" href="../icepack_index.html" />
    <link rel="prev" title="4.5. Adding tracers" href="dg_adding_tracers.html" /> 
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../icepack_index.html" title="5. Index of primary variables and parameters"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="dg_adding_tracers.html" title="4.5. Adding tracers"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Icepack 1.0.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">4. Developer Guide</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="documentation-system">
<span id="doc"></span><h1>4.6. Documentation System<a class="headerlink" href="#documentation-system" title="Permalink to this headline">¶</a></h1>
<p>With Icepack development, corresponding updates or modification to the Icepack
documentation are required. Whenever you modify the model you should update
documentation. Icepack uses Sphinx to create online HTML documentation.</p>
<div class="section" id="faqs">
<h2>4.6.1. FAQs<a class="headerlink" href="#faqs" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p class="first">What are Sphinx and reStructuredText (RST)?</p>
<p>The CICE and Icepack documentation is written using reStructuredText (RST) markup language.
ReStructuredText is a markup language, like HTML, markdown or LaTeX. Sphinx is a python tool
for publishing RST documents in other formats such as HTML and PDF. Additional information
about using RST and Sphinx are found in the sections below.</p>
</li>
<li><p class="first">What is expected of <em>me</em> when changing the documentation?</p>
<p>We expect that if you need to add or modify documentation that you will be able to modify the
RST source files and generate HTML using Sphinx in order to review the HTML documentation. We
will review the RST and HTML during a Pull Request to verify it is working properly and is consistent
with the rest of the CICE-Consortium documentation format.</p>
<p>We do not expect you to generate a PDF of your documentation changes and include this as part of a
Pull Request. Updated PDF documentation will be generated for each new release. The online HTML
documentation, however, will be updated regularly with regular code development workflow.</p>
</li>
<li><p class="first">Where are the documentation files kept?</p>
<p>A PDF of the latest release documentation is available in the master branch at /doc/Icepack-v*.pdf.
This document is generated by the CICE-Consortium team and will be updated with releases. The HTML
on the website is kept up to date with the developing code, and is therefore updated more often than the PDF.</p>
<p>The RST source files for generating html are stored in the master branch of the repository under /doc/source/.</p>
<dl class="docutils">
<dt>On your local fork, when you modify RST and use it to generate HTML, the HTML files are created in the</dt>
<dd><p class="first last">/doc/build/html/ directory and can be opened locally for review as you modify the documentation.</p>
</dd>
</dl>
<p>For the CICE Consortium, the tested and vetted HTML pages brought in through successful Pull Requests are
stored in the gh-pages branch of the repository and accessible from the URL to the linked, searchable
User’s Guide on in the README.md file at the top level of the Icepack repository or on the main wiki page
for Icepack (<a class="reference external" href="https://github.com/CICE-Consortium/Icepack/wiki">https://github.com/CICE-Consortium/Icepack/wiki</a>). Note that gh-pages is an orphan
branch (see below for details) of the repository and has <em>only</em> the Sphinx generated HTML documentation
and nothing else.</p>
</li>
</ol>
</div>
<div class="section" id="steps-for-modifying-documentation">
<h2>4.6.2. Steps for Modifying Documentation<a class="headerlink" href="#steps-for-modifying-documentation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="installing-sphinx">
<h3>4.6.2.1. Installing Sphinx<a class="headerlink" href="#installing-sphinx" title="Permalink to this headline">¶</a></h3>
<p>This must be done once on each platform. See <a class="reference external" href="http://www.sphinx-doc.org/en/stable/">Sphinx</a> or
<a class="reference external" href="http://www.sphinx-doc.org/en/stable/install.html">Installing Sphinx</a> for details. Below are the
commands for installing Sphinx on a mac laptop at the command line.
Other platforms may require other steps.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ sudo pip install --ignore-installed sphinx
$ sudo pip install --ignore-installed sphinxcontrib-bibtex
</pre></div>
</div>
<p>The CICE Consortium uses the following software to get successful Sphinx HTML builds, including linked
references:</p>
<ul class="simple">
<li>python 2.7.11</li>
<li>Sphinx (1.6.3)</li>
<li>sphinx-rtd-theme (0.1.9)</li>
<li>sphinxcontrib-bibtex (0.3.5)</li>
<li>sphinxcontrib-websupport (1.0.1)</li>
</ul>
<p>You will need to use the CICE Consortium’s conf.py file, which is found under /doc/source/conf.py in the repository
in order to build the Sphinx documentation.</p>
<p>To use linked references within the HTML you will need to have the sphinxcontrib-bibtex package as well as the zreferences.rst and master_list.bib files located in /doc/source/ in the master repository. The list of references in master_list.bib is currently ordered sequentially from oldest to newest and alphabetically within a given year. To add references for your documentation, edit the master_list.bib file using the Articles and Books as examples for your addition(s). Please follow the format for ordering the date/alphabetization as well as including a URL with the document’s DOI.</p>
</div>
<div class="section" id="model-sandbox-and-documentation">
<h3>4.6.2.2. Model sandbox and documentation<a class="headerlink" href="#model-sandbox-and-documentation" title="Permalink to this headline">¶</a></h3>
<p>Follow the general <a class="reference external" href="https://docs.google.com/document/d/1rR6WAvZQT9iAMUp-m_HZ06AUCCI19mguFialsMCYs9o/edit#heading=h.ugpwrwa68ov1">CICE-Consortium Git Workflow and Developer’s guide</a>
to clone the repository and create your personal fork for model modifications. Whenever you modify the model
you should update documentation. You can update the documentation on the same branch of your fork on which
you test code, or you can create a separate branch called documentation to test only the RST and HTML documentation.</p>
</div>
<div class="section" id="editing-rst-files">
<h3>4.6.2.3. Editing RST files<a class="headerlink" href="#editing-rst-files" title="Permalink to this headline">¶</a></h3>
<p>Open the RST file using a text editor and make the changes necessary. Note that from the User’s Guide documentation (see link above) there is a hyperlink called “Show Source” on the left hand column that will show you the RST source code for the HTML you are viewing. This is a good way to see the syntax for tables, equations, linking references, labeling tables or figures, and correctly identifying documentation sections or subsections.</p>
<p>Here are some resources for using RST files:</p>
<ul class="simple">
<li><a class="reference external" href="http://www.sphinx-doc.org/en/stable/rest.html">RST Primer1</a></li>
<li><a class="reference external" href="http://docutils.sourceforge.net/docs/user/rst/quickstart.html">RST Primer2</a></li>
<li><a class="reference external" href="https://wiki.typo3.org/ReST_Syntax">RST Syntax</a></li>
<li><a class="reference external" href="http://www.sphinx-doc.org/en/stable/rest.html#tables">RST tables</a> - Note that tables can be tricky in Sphinx and we prefer using <a class="reference external" href="http://docutils.sourceforge.net/docs/ref/rst/directives.html#csv-table">comma separated tables</a> whenever possible.</li>
</ul>
</div>
<div class="section" id="building-html">
<h3>4.6.2.4. Building HTML<a class="headerlink" href="#building-html" title="Permalink to this headline">¶</a></h3>
<p>Move into the /doc/ directory of your sandbox. Then execute the following command:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ make clean
</pre></div>
</div>
<p>to get rid of old HTML files. Then execute:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ make html
</pre></div>
</div>
<p>to build HTML into /build/html/ directory. It will also give you errors if there is a problem with the build that will help you figure out how you need to modify your RST files for a successful HTML build. Finally</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ open /build/html/FILE.html
</pre></div>
</div>
<p>Open the HTML on your browser for testing.</p>
</div>
<div class="section" id="push-changes-back-to-the-repository">
<h3>4.6.2.5. Push changes back to the repository<a class="headerlink" href="#push-changes-back-to-the-repository" title="Permalink to this headline">¶</a></h3>
<p>When you’re happy with the HTML you’ve generated, follow the standard CICE-Consortium
<a class="reference external" href="https://docs.google.com/document/d/1rR6WAvZQT9iAMUp-m_HZ06AUCCI19mguFialsMCYs9o/edit#heading=h.ugpwrwa68ov1">Git Workflow and Developer’s guide</a>
to do a Pull Request and make sure to note in the Pull Request Template that documentation has also
been updated. We will take care of testing and adding changed HTML to the gh-pages orphan branch.</p>
</div>
</div>
<div class="section" id="other-tips-and-tricks">
<h2>4.6.3. Other Tips and Tricks<a class="headerlink" href="#other-tips-and-tricks" title="Permalink to this headline">¶</a></h2>
<div class="section" id="converting-latex-to-rst">
<h3>4.6.3.1. Converting LaTeX to RST<a class="headerlink" href="#converting-latex-to-rst" title="Permalink to this headline">¶</a></h3>
<p>If you start from a LaTeX (<code class="docutils literal"><span class="pre">*.tex</span></code>) document you will need to convert this to the RST format that Sphinx
requires. A handy tool to do this is <a class="reference external" href="http://pandoc.org/getting-started.html">Pandoc</a>, which you
can install quickly and run from the command line.</p>
<p>Once Pandoc is installed, the basic command line syntax to convert a file is</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ pandoc NAMEIN.tex -f latex -t rst -s -ou NAMEOUT.rst
</pre></div>
</div>
<p>The NAMEOUT.rst file can be directly edited for Sphinx. Pandoc does a beautiful job of converting the text,
equations, and many tables. However, equation numbering, section linking, references, figures, and some
tables required more hands on care to be sure they render correctly.</p>
<p>Pandoc requires that the <code class="docutils literal"><span class="pre">*.tex</span></code> files be in utf-8 encoding. To easily do this open the <code class="docutils literal"><span class="pre">*.tex</span></code>
document in Emacs then do <code class="docutils literal"><span class="pre">ctrl-x</span> <span class="pre">ctrl-m</span> <span class="pre">f</span></code> and you will be prompted to enter encoding type. Just
type in <code class="docutils literal"><span class="pre">utf-8</span></code> and hit enter. Then save with <code class="docutils literal"><span class="pre">ctrl-x</span> <span class="pre">ctrl-s</span></code> . You are done and the document can be
converted with Pandoc.</p>
</div>
<div class="section" id="converting-rst-to-pdf">
<h3>4.6.3.2. Converting RST to PDF<a class="headerlink" href="#converting-rst-to-pdf" title="Permalink to this headline">¶</a></h3>
<p>Generating a PDF is more complex and currently requires a two-step process. The generation will require
recent versions of both LaTeX and Sphinx. From the /doc/ directory do the following:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ make latex
$ cd build/latex
$ make
</pre></div>
</div>
<p>Then search for the <code class="docutils literal"><span class="pre">*.pdf</span></code> document created.</p>
</div>
<div class="section" id="creating-an-orphan-branch">
<h3>4.6.3.3. Creating an orphan branch<a class="headerlink" href="#creating-an-orphan-branch" title="Permalink to this headline">¶</a></h3>
<p><strong>THIS STEP SHOULD NOT BE REQUIRED FOR ANY ADDITIONS TO DOCUMENTATION BUT A DESCRIPTION IS PROVIDED
IN THE INTEREST OF TRANSPARENCY AND REPRODUCIBILITY FOR THE BENEFIT OF USERS AND THE COMMUNITY</strong></p>
<p>An orphan branch is a branch that has no history in common with the master repository off of which it was
forked. For the CICE-Consortium, the purpose for this is that the HTML pages created by Sphinx will exist
in the orphan branch while the source RST code used to create the HTML exists in the master repository.
This way changes to the RST go into the evolving repository, but changes to the HTML are isolated to the
orphan branch. This method avoids conflicts related to the HTML that aren’t always caught by GitHub merges
and could cause the documentation to break.</p>
<p>Steps to create orphan branch:</p>
<ol class="arabic">
<li><p class="first">On GitHub website create personal fork of the repo you’re interested in</p>
</li>
<li><p class="first">On GitHub website from your fork, get link for the repository</p>
</li>
<li><p class="first">On your local machine execute the following commands:</p>
<p>Clone the original repository.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ git clone URL
</pre></div>
</div>
<p>List all the branches of the repository.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ git branch --l
</pre></div>
</div>
<p>Create the orphan branch gh-pages from the master branch. The branch should initially have all
documents from the master.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ git checkout --orphan gh-pages
</pre></div>
</div>
<p>Add the URL for the original repository as your “upstream” repository. Get this from Github website.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ git remote add upstream URL
</pre></div>
</div>
<p>Remove  everything in this repository. i.e. we are making it so their histories diverge.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ git rm -rf .
</pre></div>
</div>
<p>Check if all the files are gone.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ git status .
</pre></div>
</div>
<p>Commit the change to make gh-pages branch.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ git commit -m “Initial commit to create gh-pages branch of repo”
</pre></div>
</div>
<p>Provide a list of remote repositories and links. Should show your personal fork as “origin” and
the original repository as “upstream”.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ git remote --v
</pre></div>
</div>
<p>Add the orphan branch, named gh-pages, to your local fork but not the original repo from which you forked.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ git push origin gh-pages
</pre></div>
</div>
</li>
<li><p class="first">Once you’ve created the gh-pages branch on your personal fork do a pull request to incorporate the new branch
into the master repository. This way someone else will review what you’ve done and make sure you don’t delete
an entire repository by accident. It is possible to push the gh-pages branch upstream if you have owner status;
<strong>be very careful if you do this.</strong></p>
</li>
<li><p class="first">For a new orphan branch, set up sphinx stuff by executing the following commands:</p>
<p>Go to doc directory.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ cd doc
</pre></div>
</div>
<p>Make a source directory.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ mkdir source
</pre></div>
</div>
<p>Initiate sphinx interactive session to create a conf.py file. Note that the conf.py file can be changed later on.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ sphinx-quickstart
</pre></div>
</div>
<p>Answer the prompts</p>
<p>Set GitHub to ignore HTML and Emacs back up files during commits, pushes, and pull requests.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ cp .gitignore from CICE-Consortium CICE or Icepack master repository
</pre></div>
</div>
<p>Add the two new files (conf.py, .gitignore).</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ git add .
</pre></div>
</div>
<p>Commit the changes.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ git commit -m “Initial setup for Sphinx documentation”
</pre></div>
</div>
</li>
<li><p class="first">Do a pull request to add these to the master repository.</p>
</li>
</ol>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">4.6. Documentation System</a><ul>
<li><a class="reference internal" href="#faqs">4.6.1. FAQs</a></li>
<li><a class="reference internal" href="#steps-for-modifying-documentation">4.6.2. Steps for Modifying Documentation</a><ul>
<li><a class="reference internal" href="#installing-sphinx">4.6.2.1. Installing Sphinx</a></li>
<li><a class="reference internal" href="#model-sandbox-and-documentation">4.6.2.2. Model sandbox and documentation</a></li>
<li><a class="reference internal" href="#editing-rst-files">4.6.2.3. Editing RST files</a></li>
<li><a class="reference internal" href="#building-html">4.6.2.4. Building HTML</a></li>
<li><a class="reference internal" href="#push-changes-back-to-the-repository">4.6.2.5. Push changes back to the repository</a></li>
</ul>
</li>
<li><a class="reference internal" href="#other-tips-and-tricks">4.6.3. Other Tips and Tricks</a><ul>
<li><a class="reference internal" href="#converting-latex-to-rst">4.6.3.1. Converting LaTeX to RST</a></li>
<li><a class="reference internal" href="#converting-rst-to-pdf">4.6.3.2. Converting RST to PDF</a></li>
<li><a class="reference internal" href="#creating-an-orphan-branch">4.6.3.3. Creating an orphan branch</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="dg_adding_tracers.html"
                        title="previous chapter">4.5. Adding tracers</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../icepack_index.html"
                        title="next chapter">5. Index of primary variables and parameters</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/developer_guide/dg_documentation.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../icepack_index.html" title="5. Index of primary variables and parameters"
             >next</a></li>
        <li class="right" >
          <a href="dg_adding_tracers.html" title="4.5. Adding tracers"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Icepack 1.0.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >4. Developer Guide</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, Los Alamos National Security, LLC (code) and National Center for Atmospheric Research (documentation).
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.3.
    </div>
  </body>
</html>