
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>3.3. Testing Icepack &#8212; Icepack 0.0.01 documentation</title>
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.0.01',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="3.4. Case Settings" href="ug_case_settings.html" />
    <link rel="prev" title="3.2. Running Icepack" href="ug_running.html" /> 
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="ug_case_settings.html" title="3.4. Case Settings"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="ug_running.html" title="3.2. Running Icepack"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Icepack 0.0.01 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">3. User Guide</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="testing-icepack">
<span id="testing"></span><h1>3.3. Testing Icepack<a class="headerlink" href="#testing-icepack" title="Permalink to this headline">¶</a></h1>
<p>This section documents primarily how to use the Icepack scripts to carry
out icepack testing.  Exactly what to test is a separate question and
depends on the kinds of code changes being made.  Prior to merging
changes to the CICE Consortium master, changes will be reviewed and
developers will need to provide a summary of the tests carried out.</p>
<p>There is a base suite of tests provided by default with Icepack and this
may be a good starting point for testing.</p>
<dl class="docutils">
<dt>The testing scripts support several features</dt>
<dd><ul class="first last simple">
<li>Ability to test individual (via <code class="docutils literal"><span class="pre">--test</span></code>)or multiple tests (via <code class="docutils literal"><span class="pre">--suite</span></code>)
using an input file to define the suite</li>
<li>Ability to use test suite defined in the package or test suites defined by the user</li>
<li>Ability to store test results for regresssion testing (<code class="docutils literal"><span class="pre">--bgen</span></code>)</li>
<li>Ability to compare results to prior baselines to verify bit-for-bit (<code class="docutils literal"><span class="pre">--bcmp</span></code>)</li>
<li>Ability to define where baseline tests are stored</li>
<li>Ability to compare tests against each other (<code class="docutils literal"><span class="pre">--diff</span></code>)</li>
</ul>
</dd>
</dl>
<div class="section" id="individual-tests">
<span id="indtests"></span><h2>3.3.1. Individual Tests<a class="headerlink" href="#individual-tests" title="Permalink to this headline">¶</a></h2>
<p>The Icepack scripts support both setup of individual tests as well as test suites.  Individual
tests are run from the command line:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">icepack</span><span class="o">.</span><span class="n">setup</span> <span class="o">--</span><span class="n">test</span> <span class="n">smoke</span> <span class="o">--</span><span class="n">mach</span> <span class="n">conrad</span> <span class="o">--</span><span class="n">env</span> <span class="n">cray</span> <span class="o">--</span><span class="nb">set</span> <span class="n">diag1</span><span class="p">,</span><span class="n">debug</span> <span class="o">--</span><span class="n">testid</span> <span class="n">myid</span>
</pre></div>
</div>
<p>Tests are just like cases but have some additional scripting around them.  Individual
tests can be created and manually modified just like cases.
Many of the command line arguments for individual tests
are similar to <a class="reference internal" href="ug_running.html#case-options"><span class="std std-ref">Command Line Options</span></a> for <code class="docutils literal"><span class="pre">--case</span></code>.
For individual tests, the following command line options can be set</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">--test</span></code> TESTNAME</dt>
<dd>specifies the test type.  This is probably either smoke or restart but see <cite>icepack.setup –help</cite> for the latest.  This is required instead of <code class="docutils literal"><span class="pre">--case</span></code>.</dd>
<dt><code class="docutils literal"><span class="pre">--testid</span></code> ID</dt>
<dd>specifies the testid.  This is required for every use of <code class="docutils literal"><span class="pre">--test</span></code> and <code class="docutils literal"><span class="pre">--suite</span></code>.  This is a user defined string that will allow each test to have a unique case and run directory name.  This is also required.</dd>
</dl>
<p><code class="docutils literal"><span class="pre">--mach</span></code> MACHINE (see <a class="reference internal" href="ug_running.html#case-options"><span class="std std-ref">Command Line Options</span></a>)</p>
<p><code class="docutils literal"><span class="pre">--env</span></code> ENVIRONMENT1 (see <a class="reference internal" href="ug_running.html#case-options"><span class="std std-ref">Command Line Options</span></a>)</p>
<p><code class="docutils literal"><span class="pre">--set</span></code> SET1,SET2,SET3 (see <a class="reference internal" href="ug_running.html#case-options"><span class="std std-ref">Command Line Options</span></a>)</p>
<p><code class="docutils literal"><span class="pre">--acct</span></code> ACCOUNT (see <a class="reference internal" href="ug_running.html#case-options"><span class="std std-ref">Command Line Options</span></a>)</p>
<p><code class="docutils literal"><span class="pre">--grid</span></code> GRID (see <a class="reference internal" href="ug_running.html#case-options"><span class="std std-ref">Command Line Options</span></a>)</p>
<p><code class="docutils literal"><span class="pre">--pes</span></code> MxN (see <a class="reference internal" href="ug_running.html#case-options"><span class="std std-ref">Command Line Options</span></a>)</p>
<p>Like <code class="docutils literal"><span class="pre">--case</span></code>, <code class="docutils literal"><span class="pre">--grid</span></code> and <code class="docutils literal"><span class="pre">--pes</span></code> are not particularly
useful right now within Icepack since the model can only run serially and only
with the col grid setting.
There are several additional options that come with <code class="docutils literal"><span class="pre">--test</span></code> that are not available
with <code class="docutils literal"><span class="pre">--case</span></code> for regression and comparision testing,</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">--bdir</span></code> DIR</dt>
<dd>specifies the top level location of the baseline results.  This is used in conjuction with <code class="docutils literal"><span class="pre">--bgen</span></code> and <code class="docutils literal"><span class="pre">--bcmp</span></code>.  The default is set by ICE_MACHINE_BASELINE in the env.[machine]_[environment] file.</dd>
<dt><code class="docutils literal"><span class="pre">--bgen</span></code> DIR</dt>
<dd>specifies the name of the directory under [bdir] where test results will be stored.  When this flag is set, it automatically creates that directory and stores results from the test under that directory.  If DIR is set to <code class="docutils literal"><span class="pre">default</span></code>, then the scripts will automatically generate a directory name based on the Icepack hash and the date and time.  This can be useful for tracking the baselines by hash.</dd>
<dt><code class="docutils literal"><span class="pre">--bcmp</span></code> DIR</dt>
<dd>specifies the name of the directory under [bdir] that the current tests will be compared to.  When this flag is set, it automatically invokes regression testing and compares results from the current test to those prior results.  If DIR is set to <code class="docutils literal"><span class="pre">default</span></code>, then the script will automatically generate the last directory name in the [bdir] directory.  This can be useful for automated regression testing.</dd>
<dt><code class="docutils literal"><span class="pre">--diff</span></code> LONG_TESTNAME</dt>
<dd>invokes a comparison against another local test.  This allows different tests to be compared to each other.  The restrictions are that the test has to already be completed and the testid has to match.</dd>
</dl>
<p>The format of the case directory name for a test will always be
<code class="docutils literal"><span class="pre">[machine]_[env]_[test]_[grid]_[pes]_[sets].[testid]</span></code>
The [sets] will always be sorted alphabetically by the script so <code class="docutils literal"><span class="pre">--set</span> <span class="pre">debug,diag1</span></code> and
<code class="docutils literal"><span class="pre">--set</span> <span class="pre">diag1,debug</span></code> produces the same testname and test with _debug_diag1 in that order.</p>
<p>To build and run a test, the process is the same as a case.  cd to the
test directory, run the build script, and run the submit script:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="p">[</span><span class="n">test_case</span><span class="p">]</span>
<span class="o">./</span><span class="n">icepack</span><span class="o">.</span><span class="n">build</span>
<span class="o">./</span><span class="n">icepack</span><span class="o">.</span><span class="n">submit</span>
</pre></div>
</div>
<p>The test results will be generated in a local file called <strong>test_output</strong>.
To check those results:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="n">test_output</span>
</pre></div>
</div>
<p>Tests are defined under <strong>configuration/scripts/tests/</strong>.  The tests currently supported are:</p>
<ul>
<li><dl class="first docutils">
<dt>smoke   - Runs the model for default length.  The length and options can</dt>
<dd><p class="first last">be set with the <code class="docutils literal"><span class="pre">--set</span></code> command line option.  The test passes if the
model completes successfully.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>restart - Runs the model for 14 months, writing a restart file at month 3 and</dt>
<dd><p class="first last">again at the end of the run.  Runs the model a second time starting from the
month 3 restart and writing a restart at month 12 of the model run.
The test passes if both runs complete and
if the restart files at month 12 from both runs are bit-for-bit identical.</p>
</dd>
</dl>
</li>
</ul>
<p>Please run <code class="docutils literal"><span class="pre">./icepack.setup</span> <span class="pre">--help</span></code> for the latest information.</p>
<div class="section" id="example-basic-default-single-test">
<h3>3.3.1.1. Example.  Basic default single test<a class="headerlink" href="#example-basic-default-single-test" title="Permalink to this headline">¶</a></h3>
<p>Define the test, mach, env, and testid.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">icepack</span><span class="o">.</span><span class="n">setup</span> <span class="o">--</span><span class="n">test</span> <span class="n">smoke</span> <span class="o">--</span><span class="n">mach</span> <span class="n">wolf</span> <span class="o">--</span><span class="n">env</span> <span class="n">gnu</span> <span class="o">--</span><span class="n">testid</span> <span class="n">t00</span>
<span class="n">cd</span> <span class="n">wolf_gnu_smoke_col_1x1</span><span class="o">.</span><span class="n">t00</span>
<span class="o">./</span><span class="n">icepack</span><span class="o">.</span><span class="n">build</span>
<span class="o">./</span><span class="n">icepack</span><span class="o">.</span><span class="n">submit</span>
<span class="o">./</span><span class="n">cat</span> <span class="n">test_output</span>
</pre></div>
</div>
</div>
<div class="section" id="example-simple-test-with-some-options">
<h3>3.3.1.2. Example. Simple test with some options<a class="headerlink" href="#example-simple-test-with-some-options" title="Permalink to this headline">¶</a></h3>
<p>Add <code class="docutils literal"><span class="pre">--set</span></code></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">icepack</span><span class="o">.</span><span class="n">setup</span> <span class="o">--</span><span class="n">test</span> <span class="n">smoke</span> <span class="o">--</span><span class="n">mach</span> <span class="n">wolf</span> <span class="o">--</span><span class="n">env</span> <span class="n">gnu</span> <span class="o">--</span><span class="nb">set</span> <span class="n">diag1</span><span class="p">,</span><span class="n">debug</span> <span class="o">--</span><span class="n">testid</span> <span class="n">t00</span>
<span class="n">cd</span> <span class="n">wolf_gnu_smoke_col_1x1_debug_diag1</span><span class="o">.</span><span class="n">t00</span>
<span class="o">./</span><span class="n">icepack</span><span class="o">.</span><span class="n">build</span>
<span class="o">./</span><span class="n">icepack</span><span class="o">.</span><span class="n">submit</span>
<span class="o">./</span><span class="n">cat</span> <span class="n">test_output</span>
</pre></div>
</div>
</div>
<div class="section" id="example-single-test-generate-a-baseline-dataset">
<h3>3.3.1.3. Example. Single test, generate a baseline dataset<a class="headerlink" href="#example-single-test-generate-a-baseline-dataset" title="Permalink to this headline">¶</a></h3>
<p>Add <code class="docutils literal"><span class="pre">--bgen</span></code></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">icepack</span><span class="o">.</span><span class="n">setup</span> <span class="o">--</span><span class="n">test</span> <span class="n">smoke</span> <span class="o">--</span><span class="n">mach</span> <span class="n">wolf</span> <span class="o">-</span><span class="n">env</span> <span class="n">gnu</span> <span class="o">--</span><span class="n">bgen</span> <span class="n">icepack</span><span class="o">.</span><span class="n">v01</span> <span class="o">--</span><span class="n">testid</span> <span class="n">t00</span> <span class="o">--</span><span class="nb">set</span> <span class="n">diag1</span>
<span class="n">cd</span> <span class="n">wolf_gnu_smoke_col_1x1_diag1</span><span class="o">.</span><span class="n">t00</span>
<span class="o">./</span><span class="n">icepack</span><span class="o">.</span><span class="n">build</span>
<span class="o">./</span><span class="n">icepack</span><span class="o">.</span><span class="n">submit</span>
<span class="o">./</span><span class="n">cat</span> <span class="n">test_output</span>
</pre></div>
</div>
</div>
<div class="section" id="example-single-test-compare-results-to-a-prior-baseline">
<h3>3.3.1.4. Example. Single test, compare results to a prior baseline.<a class="headerlink" href="#example-single-test-compare-results-to-a-prior-baseline" title="Permalink to this headline">¶</a></h3>
<p>Add <code class="docutils literal"><span class="pre">--bcmp</span></code>.  For this to work,
the prior baseline must exist and have the exact same base testname
[machine]_[env]_[test]_[grid]_[pes]_[sets]</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">icepack</span><span class="o">.</span><span class="n">setup</span> <span class="o">--</span><span class="n">test</span> <span class="n">smoke</span> <span class="o">--</span><span class="n">mach</span> <span class="n">wolf</span> <span class="o">-</span><span class="n">env</span> <span class="n">gnu</span> <span class="o">--</span><span class="n">bcmp</span> <span class="n">icepack</span><span class="o">.</span><span class="n">v01</span> <span class="o">--</span><span class="n">testid</span> <span class="n">t01</span> <span class="o">--</span><span class="nb">set</span> <span class="n">diag1</span>
<span class="n">cd</span> <span class="n">wolf_gnu_smoke_col_1x1_diag1</span><span class="o">.</span><span class="n">t01</span>
<span class="o">./</span><span class="n">icepack</span><span class="o">.</span><span class="n">build</span>
<span class="o">./</span><span class="n">icepack</span><span class="o">.</span><span class="n">submit</span>
<span class="o">./</span><span class="n">cat</span> <span class="n">test_output</span>
</pre></div>
</div>
</div>
<div class="section" id="example-simple-test-generate-a-baseline-dataset-and-compare-to-a-prior-baseline">
<h3>3.3.1.5. Example. Simple test, generate a baseline dataset and compare to a prior baseline<a class="headerlink" href="#example-simple-test-generate-a-baseline-dataset-and-compare-to-a-prior-baseline" title="Permalink to this headline">¶</a></h3>
<p>Use <code class="docutils literal"><span class="pre">--bgen</span></code> and <code class="docutils literal"><span class="pre">--bcmp</span></code>.  The prior baseline must exist already.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">icepack</span><span class="o">.</span><span class="n">setup</span> <span class="o">--</span><span class="n">test</span> <span class="n">smoke</span> <span class="o">--</span><span class="n">mach</span> <span class="n">wolf</span> <span class="o">-</span><span class="n">env</span> <span class="n">gnu</span> <span class="o">--</span><span class="n">bgen</span> <span class="n">icepack</span><span class="o">.</span><span class="n">v02</span> <span class="o">--</span><span class="n">bcmp</span> <span class="n">icepack</span><span class="o">.</span><span class="n">v01</span> <span class="o">--</span><span class="n">testid</span> <span class="n">t02</span> <span class="o">--</span><span class="nb">set</span> <span class="n">diag1</span>
<span class="n">cd</span> <span class="n">wolf_gnu_smoke_col_1x1_diag1</span><span class="o">.</span><span class="n">t02</span>
<span class="o">./</span><span class="n">icepack</span><span class="o">.</span><span class="n">build</span>
<span class="o">./</span><span class="n">icepack</span><span class="o">.</span><span class="n">submit</span>
<span class="o">./</span><span class="n">cat</span> <span class="n">test_output</span>
</pre></div>
</div>
</div>
<div class="section" id="example-simple-test-comparison-against-another-test">
<h3>3.3.1.6. Example. Simple test, comparison against another test<a class="headerlink" href="#example-simple-test-comparison-against-another-test" title="Permalink to this headline">¶</a></h3>
<p>Use <code class="docutils literal"><span class="pre">--diff</span></code>.  This feature is primarily used in test suites and has
limited use in icepack, but is being described for completeness.</p>
<p><code class="docutils literal"><span class="pre">--diff</span></code> provides a way to compare tests with each other.
For this to work, the tests have to be run in a specific order and
the testids need to match.  The test
is always compared relative to the current case directory.</p>
<p>To run the first test,</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">icepack</span><span class="o">.</span><span class="n">setup</span> <span class="o">--</span><span class="n">test</span> <span class="n">smoke</span> <span class="o">--</span><span class="n">mach</span> <span class="n">wolf</span> <span class="o">-</span><span class="n">env</span> <span class="n">gnu</span> <span class="o">--</span><span class="n">testid</span> <span class="n">tx01</span> <span class="o">--</span><span class="nb">set</span> <span class="n">debug</span>
<span class="n">cd</span> <span class="n">wolf_gnu_smoke_col_1x1_debug</span><span class="o">.</span><span class="n">tx01</span>
<span class="o">./</span><span class="n">icepack</span><span class="o">.</span><span class="n">build</span>
<span class="o">./</span><span class="n">icepack</span><span class="o">.</span><span class="n">submit</span>
<span class="o">./</span><span class="n">cat</span> <span class="n">test_output</span>
</pre></div>
</div>
<p>Then to run the second test and compare to the results from the first test</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">icepack</span><span class="o">.</span><span class="n">setup</span> <span class="o">--</span><span class="n">test</span> <span class="n">smoke</span> <span class="o">--</span><span class="n">mach</span> <span class="n">wolf</span> <span class="o">-</span><span class="n">env</span> <span class="n">gnu</span> <span class="o">--</span><span class="n">testid</span> <span class="n">tx01</span> <span class="o">--</span><span class="n">diff</span> <span class="n">smoke_col_1x1_debug</span>
<span class="n">cd</span> <span class="n">wolf_gnu_smoke_col_1x1</span><span class="o">.</span><span class="n">tx01</span>
<span class="o">./</span><span class="n">icepack</span><span class="o">.</span><span class="n">build</span>
<span class="o">./</span><span class="n">icepack</span><span class="o">.</span><span class="n">submit</span>
<span class="o">./</span><span class="n">cat</span> <span class="n">test_output</span>
</pre></div>
</div>
<p>The scripts will add a [machine]_[environment] to the beginning of the diff
argument and the same testid to the end of the diff argument.  Then the runs
will be compared for bit-for-bit and a result will be produced in test_output.
This is really more useful in CICE and for test suites right now.  For example,
CICE uses this feature to compare results from different pe counts or
decompositions, single threaded vs multi-threaded, and so forth.</p>
</div>
</div>
<div class="section" id="test-suites">
<span id="testsuites"></span><h2>3.3.2. Test suites<a class="headerlink" href="#test-suites" title="Permalink to this headline">¶</a></h2>
<p>Test suites support running multiple tests specified via
an input file.  When invoking the test suite option (<code class="docutils literal"><span class="pre">--suite</span></code>) with <strong>icepack.setup</strong>,
all tests will be created, built, and submitted automatically under
a directory called [suite_name].[testid] as part of involing the suite.
Because the tests are built and submitted automatically,
this feature does not allow for customization of cases or tests like
individual cases and tests do:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">icepack</span><span class="o">.</span><span class="n">setup</span> <span class="o">--</span><span class="n">suite</span> <span class="n">base_suite</span> <span class="o">--</span><span class="n">mach</span> <span class="n">wolf</span> <span class="o">--</span><span class="n">env</span> <span class="n">gnu</span> <span class="o">--</span><span class="n">testid</span> <span class="n">myid</span>
</pre></div>
</div>
<p>Like an individual test, the <code class="docutils literal"><span class="pre">--testid</span></code> option must be specified and can be any
string.  Once the tests are complete, results can be checked by running the
results.csh script in the [suite_name].[testid]:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">base_suite</span><span class="o">.</span><span class="p">[</span><span class="n">testid</span><span class="p">]</span>
<span class="o">./</span><span class="n">results</span><span class="o">.</span><span class="n">csh</span>
</pre></div>
</div>
<p>The predefined test suites are defined under <strong>configuration/scripts/tests</strong> and
the files defining the suites
have a suffix of .ts in that directory.  The format for the test suite file
is relatively simple.
It is a text file with white space delimited
columns that define a handful of values in a specific order.
The first column is the test name, the second the grid, the third the pe count,
the fourth column is
the <code class="docutils literal"><span class="pre">--set</span></code> options and the fifth column is the <code class="docutils literal"><span class="pre">--diff</span></code> argument.
(The grid and PEs columns are provided
for compatibility with the similar CICE scripts.)  The fourth and fifth columns are
optional.
Lines that begin with # or are blank are ignored.  For example,</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1">#Test   Grid  PEs  Sets                Diff</span>
 <span class="n">smoke</span>   <span class="n">col</span>  <span class="mi">1</span><span class="n">x1</span>  <span class="n">diag1</span>
 <span class="n">smoke</span>   <span class="n">col</span>  <span class="mi">1</span><span class="n">x1</span>  <span class="n">diag1</span><span class="p">,</span><span class="n">run1year</span>  <span class="n">smoke_col_1x1_diag1</span>
 <span class="n">smoke</span>   <span class="n">col</span>  <span class="mi">1</span><span class="n">x1</span>  <span class="n">debug</span><span class="p">,</span><span class="n">run1year</span>
<span class="n">restart</span>  <span class="n">col</span>  <span class="mi">1</span><span class="n">x1</span>  <span class="n">debug</span>
<span class="n">restart</span>  <span class="n">col</span>  <span class="mi">1</span><span class="n">x1</span>  <span class="n">diag1</span>
<span class="n">restart</span>  <span class="n">col</span>  <span class="mi">1</span><span class="n">x1</span>  <span class="n">pondcesm</span>
<span class="n">restart</span>  <span class="n">col</span>  <span class="mi">1</span><span class="n">x1</span>  <span class="n">pondlvl</span>
<span class="n">restart</span>  <span class="n">col</span>  <span class="mi">1</span><span class="n">x1</span>  <span class="n">pondtopo</span>
</pre></div>
</div>
<p>The argument to <code class="docutils literal"><span class="pre">--suite</span></code> defines the test suite (.ts) filename and that argument
can contain a path.
<strong>icepack.setup</strong>
will look for the filename in the local directory, in <strong>configuration/scripts/tests/</strong>,
or in the path defined by the <code class="docutils literal"><span class="pre">--suite</span></code> option.</p>
<p>Because many of the command line options are specified in the input file, ONLY the
following options are valid for suites,</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">--suite</span></code> filename</dt>
<dd>required, input filename with list of suites</dd>
<dt><code class="docutils literal"><span class="pre">--mach</span></code> MACHINE</dt>
<dd>required</dd>
<dt><code class="docutils literal"><span class="pre">--env</span></code> ENVIRONMENT1,ENVIRONMENT2</dt>
<dd>strongly recommended</dd>
<dt><code class="docutils literal"><span class="pre">--acct</span></code> ACCOUNT</dt>
<dd>optional</dd>
<dt><code class="docutils literal"><span class="pre">--testid</span></code> ID</dt>
<dd>required</dd>
<dt><code class="docutils literal"><span class="pre">--bdir</span></code> DIR</dt>
<dd>optional, top level baselines directory and defined by default by ICE_MACHINE_BASELINE in <strong>env.[machine]_[environment]</strong>.</dd>
<dt><code class="docutils literal"><span class="pre">--bgen</span></code> DIR</dt>
<dd>recommended, test output is copied to this directory under [bdir]</dd>
<dt><code class="docutils literal"><span class="pre">--bcmp</span></code> DIR</dt>
<dd>recommended, test output are compared to prior results in this directory under [bdir]</dd>
<dt><code class="docutils literal"><span class="pre">--report</span></code></dt>
<dd>This is only used by <code class="docutils literal"><span class="pre">--suite</span></code> and when set, invokes a script that sends the test results to the results page when all tests are complete.  Please see <a class="reference internal" href="#testreporting"><span class="std std-ref">Test Reporting</span></a> for more information.</dd>
</dl>
<p>Please see <a class="reference internal" href="ug_running.html#case-options"><span class="std std-ref">Command Line Options</span></a> and <a class="reference internal" href="#indtests"><span class="std std-ref">Individual Tests</span></a> for more details about how these options are used.</p>
<div class="section" id="example-basic-test-suite">
<h3>3.3.2.1. Example. Basic test suite<a class="headerlink" href="#example-basic-test-suite" title="Permalink to this headline">¶</a></h3>
<p>Specify suite, mach, env, testid.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">icepack</span><span class="o">.</span><span class="n">setup</span> <span class="o">--</span><span class="n">suite</span> <span class="n">base_suite</span> <span class="o">--</span><span class="n">mach</span> <span class="n">conrad</span> <span class="o">--</span><span class="n">env</span> <span class="n">cray</span> <span class="o">--</span><span class="n">testid</span> <span class="n">v01a</span>
<span class="n">cd</span> <span class="n">base_suite</span><span class="o">.</span><span class="n">v01a</span>
<span class="c1">#wait for runs to complete</span>
<span class="o">./</span><span class="n">results</span><span class="o">.</span><span class="n">csh</span>
</pre></div>
</div>
</div>
<div class="section" id="example-basic-test-suite-on-multiple-environments">
<h3>3.3.2.2. Example. Basic test suite on multiple environments<a class="headerlink" href="#example-basic-test-suite-on-multiple-environments" title="Permalink to this headline">¶</a></h3>
<p>Specify multiple envs.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">icepack</span><span class="o">.</span><span class="n">setup</span> <span class="o">--</span><span class="n">suite</span> <span class="n">base_suite</span> <span class="o">--</span><span class="n">mach</span> <span class="n">conrad</span> <span class="o">--</span><span class="n">env</span> <span class="n">cray</span><span class="p">,</span><span class="n">pgi</span><span class="p">,</span><span class="n">intel</span><span class="p">,</span><span class="n">gnu</span> <span class="o">--</span><span class="n">testid</span> <span class="n">v01a</span>
<span class="n">cd</span> <span class="n">base_suite</span><span class="o">.</span><span class="n">v01a</span>
<span class="c1">#wait for runs to complete</span>
<span class="o">./</span><span class="n">results</span><span class="o">.</span><span class="n">csh</span>
</pre></div>
</div>
<p>Each env can be run as a separate invokation of <cite>icepack.setup</cite> but if that
approach is taken, it is recommended that different testids be used.</p>
</div>
<div class="section" id="example-basic-test-suite-store-baselines-in-user-defined-name">
<h3>3.3.2.3. Example. Basic test suite, store baselines in user defined name<a class="headerlink" href="#example-basic-test-suite-store-baselines-in-user-defined-name" title="Permalink to this headline">¶</a></h3>
<p>Add <code class="docutils literal"><span class="pre">--bgen</span></code></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">icepack</span><span class="o">.</span><span class="n">setup</span> <span class="o">--</span><span class="n">suite</span> <span class="n">base_suite</span> <span class="o">--</span><span class="n">mach</span> <span class="n">conrad</span> <span class="o">--</span><span class="n">env</span> <span class="n">cray</span> <span class="o">--</span><span class="n">testid</span> <span class="n">v01a</span> <span class="o">--</span><span class="n">bgen</span> <span class="n">icepack</span><span class="o">.</span><span class="n">v01a</span>
<span class="n">cd</span> <span class="n">base_suite</span><span class="o">.</span><span class="n">v01a</span>
<span class="c1">#wait for runs to complete</span>
<span class="o">./</span><span class="n">results</span><span class="o">.</span><span class="n">csh</span>
</pre></div>
</div>
<p>This will store the results in the default [bdir] directory under the subdirectory icepack.v01a.</p>
</div>
<div class="section" id="example-basic-test-suite-store-baselines-in-user-defined-top-level-directory">
<h3>3.3.2.4. Example. Basic test suite, store baselines in user defined top level directory<a class="headerlink" href="#example-basic-test-suite-store-baselines-in-user-defined-top-level-directory" title="Permalink to this headline">¶</a></h3>
<p>Add <code class="docutils literal"><span class="pre">--bgen</span></code> and <code class="docutils literal"><span class="pre">--bdir</span></code></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">icepack</span><span class="o">.</span><span class="n">setup</span> <span class="o">--</span><span class="n">suite</span> <span class="n">base_suite</span> <span class="o">--</span><span class="n">mach</span> <span class="n">conrad</span> <span class="o">--</span><span class="n">env</span> <span class="n">cray</span> <span class="o">--</span><span class="n">testid</span> <span class="n">v01a</span> <span class="o">--</span><span class="n">bgen</span> <span class="n">icepack</span><span class="o">.</span><span class="n">v01a</span> <span class="o">--</span><span class="n">bdir</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">ICEPACK_BASELINES</span>
<span class="n">cd</span> <span class="n">base_suite</span><span class="o">.</span><span class="n">v01a</span>
<span class="c1">#wait for runs to complete</span>
<span class="o">./</span><span class="n">results</span><span class="o">.</span><span class="n">csh</span>
</pre></div>
</div>
<p>This will store the results in /tmp/user/ICEPACK_BASELINES/icepack.v01a.</p>
</div>
<div class="section" id="example-basic-test-suite-store-baselines-in-auto-generated-directory">
<h3>3.3.2.5. Example. Basic test suite, store baselines in auto-generated directory<a class="headerlink" href="#example-basic-test-suite-store-baselines-in-auto-generated-directory" title="Permalink to this headline">¶</a></h3>
<p>Add <code class="docutils literal"><span class="pre">--bgen</span> <span class="pre">default</span></code></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">icepack</span><span class="o">.</span><span class="n">setup</span> <span class="o">--</span><span class="n">suite</span> <span class="n">base_suite</span> <span class="o">--</span><span class="n">mach</span> <span class="n">conrad</span> <span class="o">--</span><span class="n">env</span> <span class="n">cray</span> <span class="o">--</span><span class="n">testid</span> <span class="n">v01a</span> <span class="o">--</span><span class="n">bgen</span> <span class="n">default</span>
<span class="n">cd</span> <span class="n">base_suite</span><span class="o">.</span><span class="n">v01a</span>
<span class="c1">#wait for runs to complete</span>
<span class="o">./</span><span class="n">results</span><span class="o">.</span><span class="n">csh</span>
</pre></div>
</div>
<p>This will store the results in the default [bdir] directory under a directory name generated by the script that includes the hash and date.</p>
</div>
<div class="section" id="example-basic-test-suite-compare-to-prior-baselines">
<h3>3.3.2.6. Example. Basic test suite, compare to prior baselines<a class="headerlink" href="#example-basic-test-suite-compare-to-prior-baselines" title="Permalink to this headline">¶</a></h3>
<p>Add <code class="docutils literal"><span class="pre">--bcmp</span></code></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">icepack</span><span class="o">.</span><span class="n">setup</span> <span class="o">--</span><span class="n">suite</span> <span class="n">base_suite</span> <span class="o">--</span><span class="n">mach</span> <span class="n">conrad</span> <span class="o">--</span><span class="n">env</span> <span class="n">cray</span> <span class="o">--</span><span class="n">testid</span> <span class="n">v02a</span> <span class="o">--</span><span class="n">bcmp</span> <span class="n">icepack</span><span class="o">.</span><span class="n">v01a</span>
<span class="n">cd</span> <span class="n">base_suite</span><span class="o">.</span><span class="n">v02a</span>
<span class="c1">#wait for runs to complete</span>
<span class="o">./</span><span class="n">results</span><span class="o">.</span><span class="n">csh</span>
</pre></div>
</div>
<p>This will compare to results saved in the baseline [bdir] directory under
the subdirectory icepack.v01a.  You can use other regression options as well
(<code class="docutils literal"><span class="pre">--bdir</span></code> and <code class="docutils literal"><span class="pre">--bgen</span></code>)</p>
</div>
<div class="section" id="example-basic-test-suite-use-of-default-string-in-regression-testing">
<h3>3.3.2.7. Example. Basic test suite, use of default string in regression testing<a class="headerlink" href="#example-basic-test-suite-use-of-default-string-in-regression-testing" title="Permalink to this headline">¶</a></h3>
<p>default is a special argument to <code class="docutils literal"><span class="pre">--bgen</span></code> and <code class="docutils literal"><span class="pre">--bcmp</span></code>.  When used, the
scripts will automate generation of the directories.  In the case of <code class="docutils literal"><span class="pre">--bgen</span></code>,
a unique directory name consisting of the hash and a date will be created.
In the case of <code class="docutils literal"><span class="pre">--bcmp</span></code>, the latest directory in [bdir] will automatically
be specified.  This provides a number of useful features</p>
<blockquote>
<div><ul class="simple">
<li>the <code class="docutils literal"><span class="pre">--bgen</span></code> directory will be named after the hash automatically</li>
<li>the <code class="docutils literal"><span class="pre">--bcmp</span></code> will always find the most recent set of baselines</li>
<li>the <code class="docutils literal"><span class="pre">--bcmp</span></code> reporting will include information about the comparison directory
name which will include hash information</li>
<li>automation can be invoked easily, especially if <code class="docutils literal"><span class="pre">--bdir</span></code> is used to separate
results</li>
</ul>
</div></blockquote>
<p>Imagine the case where the default settings are used and <code class="docutils literal"><span class="pre">--bdir</span></code> is used to
create a unique location.  You could easily carry out regular builds automatically via,</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>set mydate = `date -u &quot;+%Y%m%d&quot;`
git clone https://github.com/myfork/icepack icepack.$mydate
cd icepack.$mydate
./icepack.setup --suite base_suite --mach conrad --env cray,gnu,intel,pgi --testid $mydate --bcmp default --bgen default --bdir /tmp/work/user/ICEPACK_BASELINES_MASTER
</pre></div>
</div>
<p>When this is invoked, a new set of baselines will be generated and compared to the prior
results each time without having to change the arguments.</p>
</div>
<div class="section" id="example-create-and-test-a-custom-suite">
<h3>3.3.2.8. Example. Create and test a custom suite<a class="headerlink" href="#example-create-and-test-a-custom-suite" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt>Create your own input text file consisting of 5 columns of data,</dt>
<dd><ul class="first last simple">
<li>Test</li>
<li>Grid</li>
<li>pes</li>
<li>sets (optional)</li>
<li>diff test (optional)</li>
</ul>
</dd>
</dl>
<p>such as</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">cat</span> <span class="n">mysuite</span>
<span class="n">smoke</span>    <span class="n">col</span>  <span class="mi">1</span><span class="n">x1</span>  <span class="n">diag1</span><span class="p">,</span><span class="n">debug</span>
<span class="n">restart</span>  <span class="n">col</span>  <span class="mi">1</span><span class="n">x1</span>
<span class="n">restart</span>  <span class="n">col</span>  <span class="mi">1</span><span class="n">x1</span>  <span class="n">diag1</span><span class="p">,</span><span class="n">debug</span>    <span class="n">restart_col_1x1</span>
<span class="n">restart</span>  <span class="n">col</span>  <span class="mi">1</span><span class="n">x1</span>  <span class="n">mynewoption</span><span class="p">,</span><span class="n">diag1</span><span class="p">,</span><span class="n">debug</span>
</pre></div>
</div>
<p>then use that input file, mysuite</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">icepack</span><span class="o">.</span><span class="n">setup</span> <span class="o">--</span><span class="n">suite</span> <span class="n">mysuite</span> <span class="o">--</span><span class="n">mach</span> <span class="n">conrad</span> <span class="o">--</span><span class="n">env</span> <span class="n">cray</span> <span class="o">--</span><span class="n">testid</span> <span class="n">v01a</span> <span class="o">--</span><span class="n">bgen</span> <span class="n">default</span>
<span class="n">cd</span> <span class="n">mysuite</span><span class="o">.</span><span class="n">v01a</span>
<span class="c1">#wait for runs to complete</span>
<span class="o">./</span><span class="n">results</span><span class="o">.</span><span class="n">csh</span>
</pre></div>
</div>
<p>You can use all the standard regression testing options (<code class="docutils literal"><span class="pre">--bgen</span></code>, <code class="docutils literal"><span class="pre">--bcmp</span></code>,
<code class="docutils literal"><span class="pre">--bdir</span></code>).  Make sure any “diff” testing that goes on is on tests that
are created earlier in the test list, as early as possible.  Unfortunately,
there is still no absolute guarantee the tests will be completed in the correct
sequence.</p>
</div>
</div>
<div class="section" id="test-reporting">
<span id="testreporting"></span><h2>3.3.3. Test Reporting<a class="headerlink" href="#test-reporting" title="Permalink to this headline">¶</a></h2>
<p>The Icepack testing scripts have the capability to post test results
to the official <a class="reference external" href="https://github.com/CICE-Consortium/Test-Results/wiki">wiki page</a>.
You may need write permission on the wiki.  If you are interested in using the
wiki, please contact the consortium.</p>
<p>To post results, once a test suite is complete, run <code class="docutils literal"><span class="pre">results.csh</span></code> and
<code class="docutils literal"><span class="pre">report_results.csh</span></code> from the suite directory,</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">icepack</span><span class="o">.</span><span class="n">setup</span> <span class="o">--</span><span class="n">suite</span> <span class="n">base_suite</span> <span class="o">--</span><span class="n">mach</span> <span class="n">conrad</span> <span class="o">--</span><span class="n">env</span> <span class="n">cray</span> <span class="o">--</span><span class="n">testid</span> <span class="n">v01a</span>
<span class="n">cd</span> <span class="n">base_suite</span><span class="o">.</span><span class="n">v01a</span>
<span class="c1">#wait for runs to complete</span>
<span class="o">./</span><span class="n">results</span><span class="o">.</span><span class="n">csh</span>
<span class="o">./</span><span class="n">report_results</span><span class="o">.</span><span class="n">csh</span>
</pre></div>
</div>
<p>The reporting can also be automated by adding <code class="docutils literal"><span class="pre">--report</span></code></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">icepack</span><span class="o">.</span><span class="n">setup</span> <span class="o">--</span><span class="n">suite</span> <span class="n">base_suite</span> <span class="o">--</span><span class="n">mach</span> <span class="n">conrad</span> <span class="o">--</span><span class="n">env</span> <span class="n">cray</span> <span class="o">--</span><span class="n">testid</span> <span class="n">v01a</span> <span class="o">--</span><span class="n">report</span>
</pre></div>
</div>
<p>With <code class="docutils literal"><span class="pre">--report</span></code>, the suite will create all the tests, build and submit them,
wait for all runs to be complete, and run the results and report_results scripts.</p>
</div>
<div class="section" id="test-plotting">
<h2>3.3.4. Test Plotting<a class="headerlink" href="#test-plotting" title="Permalink to this headline">¶</a></h2>
<p>Icepack comes with some tools that support plotting of output.
This is done on a test by test basis.  Several fields are hardwired
into the scripts at the present time.
To plot a timeseries of “total ice extent”, “total ice area”, and “total ice volume”
after completing a test run or a test suite</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">test_case_directory</span>
<span class="o">./</span><span class="n">timeseries</span><span class="o">.</span><span class="n">csh</span> <span class="o">&lt;</span><span class="n">directory</span><span class="o">&gt;</span>
<span class="n">ls</span> <span class="o">*.</span><span class="n">png</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">3.3. Testing Icepack</a><ul>
<li><a class="reference internal" href="#individual-tests">3.3.1. Individual Tests</a><ul>
<li><a class="reference internal" href="#example-basic-default-single-test">3.3.1.1. Example.  Basic default single test</a></li>
<li><a class="reference internal" href="#example-simple-test-with-some-options">3.3.1.2. Example. Simple test with some options</a></li>
<li><a class="reference internal" href="#example-single-test-generate-a-baseline-dataset">3.3.1.3. Example. Single test, generate a baseline dataset</a></li>
<li><a class="reference internal" href="#example-single-test-compare-results-to-a-prior-baseline">3.3.1.4. Example. Single test, compare results to a prior baseline.</a></li>
<li><a class="reference internal" href="#example-simple-test-generate-a-baseline-dataset-and-compare-to-a-prior-baseline">3.3.1.5. Example. Simple test, generate a baseline dataset and compare to a prior baseline</a></li>
<li><a class="reference internal" href="#example-simple-test-comparison-against-another-test">3.3.1.6. Example. Simple test, comparison against another test</a></li>
</ul>
</li>
<li><a class="reference internal" href="#test-suites">3.3.2. Test suites</a><ul>
<li><a class="reference internal" href="#example-basic-test-suite">3.3.2.1. Example. Basic test suite</a></li>
<li><a class="reference internal" href="#example-basic-test-suite-on-multiple-environments">3.3.2.2. Example. Basic test suite on multiple environments</a></li>
<li><a class="reference internal" href="#example-basic-test-suite-store-baselines-in-user-defined-name">3.3.2.3. Example. Basic test suite, store baselines in user defined name</a></li>
<li><a class="reference internal" href="#example-basic-test-suite-store-baselines-in-user-defined-top-level-directory">3.3.2.4. Example. Basic test suite, store baselines in user defined top level directory</a></li>
<li><a class="reference internal" href="#example-basic-test-suite-store-baselines-in-auto-generated-directory">3.3.2.5. Example. Basic test suite, store baselines in auto-generated directory</a></li>
<li><a class="reference internal" href="#example-basic-test-suite-compare-to-prior-baselines">3.3.2.6. Example. Basic test suite, compare to prior baselines</a></li>
<li><a class="reference internal" href="#example-basic-test-suite-use-of-default-string-in-regression-testing">3.3.2.7. Example. Basic test suite, use of default string in regression testing</a></li>
<li><a class="reference internal" href="#example-create-and-test-a-custom-suite">3.3.2.8. Example. Create and test a custom suite</a></li>
</ul>
</li>
<li><a class="reference internal" href="#test-reporting">3.3.3. Test Reporting</a></li>
<li><a class="reference internal" href="#test-plotting">3.3.4. Test Plotting</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="ug_running.html"
                        title="previous chapter">3.2. Running Icepack</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="ug_case_settings.html"
                        title="next chapter">3.4. Case Settings</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/user_guide/ug_testing.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="ug_case_settings.html" title="3.4. Case Settings"
             >next</a></li>
        <li class="right" >
          <a href="ug_running.html" title="3.2. Running Icepack"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Icepack 0.0.01 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >3. User Guide</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, Los Alamos National Security, LLC (code) and National Center for Atmospheric Research (documentation).
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.3.
    </div>
  </body>
</html>