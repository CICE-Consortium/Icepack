

<!doctype html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>4. Numerical implementation &#8212; CICE-Consortium Icepack 0.0.1 documentation</title>
    <link rel="stylesheet" href="_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/bizstyle.js"></script>
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="5. Troubleshooting" href="icepack_5_troubleshooting.html" />
    <link rel="prev" title="3. Model components" href="icepack_3_model_components.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="icepack_5_troubleshooting.html" title="5. Troubleshooting"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="icepack_3_model_components.html" title="3. Model components"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">CICE-Consortium Icepack 0.0.1 documentation</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">4. Numerical implementation</a><ul>
<li><a class="reference internal" href="#directory-structure">4.1. Directory structure</a></li>
<li><a class="reference internal" href="#grid-boundary-conditions-and-masks">4.2. Grid, boundary conditions and masks</a><ul>
<li><a class="reference internal" href="#bio-grid">4.2.1. Bio-grid</a></li>
<li><a class="reference internal" href="#column-configuration">4.2.2. Column configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#initialization-and-coupling">4.3. Initialization and coupling</a></li>
<li><a class="reference internal" href="#choosing-an-appropriate-time-step">4.4. Choosing an appropriate time step</a></li>
<li><a class="reference internal" href="#model-output">4.5. Model output</a><ul>
<li><a class="reference internal" href="#diagnostic-files">4.5.1. Diagnostic files</a></li>
<li><a class="reference internal" href="#restart-files">4.5.2. Restart files</a></li>
</ul>
</li>
<li><a class="reference internal" href="#execution-procedures">4.6. Execution procedures</a></li>
<li><a class="reference internal" href="#adding-things">4.7. Adding things</a><ul>
<li><a class="reference internal" href="#tracers">4.7.1. Tracers</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="icepack_3_model_components.html"
                        title="previous chapter">3. Model components</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="icepack_5_troubleshooting.html"
                        title="next chapter">5. Troubleshooting</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/icepack_4_numerical_implementation.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="numerical-implementation">
<h1>4. Numerical implementation<a class="headerlink" href="#numerical-implementation" title="Permalink to this headline">¶</a></h1>
<p>Icepack is written in FORTRAN90 and runs on platforms using UNIX, LINUX,
and other operating systems. The code is parallelized via grid
decomposition with MPI or OpenMP threads and includes some optimizations
for vector architectures.</p>
<div class="section" id="directory-structure">
<span id="dirstructure"></span><h2>4.1. Directory structure<a class="headerlink" href="#directory-structure" title="Permalink to this headline">¶</a></h2>
<p>Need to update for Icepack.</p>
<p><em>old stuff</em>
The present code distribution includes make files, several scripts and
some input files. The main directory is <strong>cice/</strong>, and a run directory
(<strong>rundir/</strong>) is created upon initial execution of the script
<strong>comp_ice</strong>. One year of atmospheric forcing data is also available
from the code distribution web site (see the <strong>README</strong> file for
details).</p>
<p><em>incomplete former list</em></p>
<p>&nbsp;history and restart modules</p>
<dl class="docutils">
<dt><strong>ice_history_write.F90</strong></dt>
<dd>subroutines with &nbsp;output</dd>
<dt><strong>ice_restart.F90</strong></dt>
<dd>read/write &nbsp; restart files</dd>
</dl>
</div>
<div class="section" id="grid-boundary-conditions-and-masks">
<h2>4.2. Grid, boundary conditions and masks<a class="headerlink" href="#grid-boundary-conditions-and-masks" title="Permalink to this headline">¶</a></h2>
<p><em>Needs update for Icepack</em></p>
<div class="section" id="bio-grid">
<span id="id1"></span><h3>4.2.1. Bio-grid<a class="headerlink" href="#bio-grid" title="Permalink to this headline">¶</a></h3>
<p>The bio-grid is a vertical grid used for solving the brine height
variable <span class="math">\(h_b\)</span>. In the future, it will also be used for
discretizing the vertical transport equations of biogeochemical tracers.
The bio-grid is a non-dimensional vertical grid which takes the value
zero at <span class="math">\(h_b\)</span> and one at the ice–ocean interface. The number of
grid levels is specified during compilation in <strong>comp_ice</strong> by setting
the variable <cite>NBGCLYR</cite> equal to an integer (<span class="math">\(n_b\)</span>) .</p>
<p>Ice tracers and microstructural properties defined on the bio-grid are
referenced in two ways: as <cite>bgrid</cite> <span class="math">\(=n_b+2\)</span> points and as
igrid<span class="math">\(=n_b+1\)</span> points. For both bgrid and igrid, the first and
last points reference <span class="math">\(h_b\)</span> and the ice–ocean interface,
respectively, and so take the values <span class="math">\(0\)</span> and <span class="math">\(1\)</span>,
respectively. For bgrid, the interior points <span class="math">\([2, n_b+1]\)</span> are
spaced at <span class="math">\(1/n_b\)</span> intervals beginning with <cite>bgrid(2)</cite> :math:` =
1/(2n_b)`. The <cite>igrid</cite> interior points <span class="math">\([2, n_b]\)</span> are also
equidistant with the same spacing, but physically coincide with points
midway between those of <cite>bgrid</cite>.</p>
</div>
<div class="section" id="column-configuration">
<h3>4.2.2. Column configuration<a class="headerlink" href="#column-configuration" title="Permalink to this headline">¶</a></h3>
<p>A column modeling capability is available. Because of the boundary
conditions and other spatial assumptions in the model, this is not a
single column, but a small array of columns (minimum grid size is 5x5).
However, the code is set up so that only the single, central column is
used (all other columns are designated as land). The column is located
near Barrow (71.35N, 156.5W). Options for choosing the column
configuration are given in <strong>comp_ice</strong> (choose <cite>RES col</cite>) and in the
namelist file, <strong>input_templates/col/ice_in</strong>. Here, <cite>istep0</cite> and the
initial conditions are set such that the run begins September 1 with no
ice. The grid type is rectangular, dynamics are turned off (<cite>kdyn</cite> = 0) and
one processor is used.</p>
<p>History variables available for column output are ice and snow
temperature, <cite>Tinz</cite> and <cite>Tsnz</cite>. These variables also include thickness
category as a fourth dimension.</p>
</div>
</div>
<div class="section" id="initialization-and-coupling">
<span id="init"></span><h2>4.3. Initialization and coupling<a class="headerlink" href="#initialization-and-coupling" title="Permalink to this headline">¶</a></h2>
<p>The ice model’s parameters and variables are initialized in several
steps. Many constants and physical parameters are set in
<strong>ice_constants.F90</strong>. Namelist variables (<a class="reference internal" href="icepack_7_namelist_opts.html#tabnamelist"><span class="std std-ref">Table of namelist options</span></a>),
whose values can be altered at run time, are handled in <em>input_data</em>
and other initialization routines. These variables are given default
values in the code, which may then be changed when the input file
<strong>ice_in</strong> is read. Other physical constants, numerical parameters, and
variables are first set in initialization routines for each ice model
component or module. Then, if the ice model is being restarted from a
previous run, core variables are read and reinitialized in
<em>restartfile</em>, while tracer variables needed for specific configurations
are read in separate restart routines associated with each tracer or
specialized parameterization. Finally, albedo and other quantities
dependent on the initial ice state are set. Some of these parameters
will be described in more detail in <a class="reference internal" href="icepack_7_namelist_opts.html#tabnamelist"><span class="std std-ref">Table of namelist options</span></a>.</p>
<p>The restart files supplied with the code release include the core
variables on the default configuration, that is, with seven vertical
layers and the ice thickness distribution defined by <cite>kcatbound</cite> = 0.
Restart information for some tracers is also included in the &nbsp;restart
files.</p>
<p>Three namelist variables control model initialization, <cite>ice_ic</cite>, <cite>runtype</cite>,
and <cite>restart</cite>, as described in <a class="reference internal" href="#tab-ic"><span class="std std-ref">Table 4</span></a>. It is possible to do an
initial run from a file <strong>filename</strong> in two ways: (1) set runtype =
‘initial’, restart = true and ice_ic = <strong>filename</strong>, or (2) runtype =
‘continue’ and pointer_file = <strong>./restart/ice.restart_file</strong> where
<strong>./restart/ice.restart_file</strong> contains the line
“./restart/[filename]”. The first option is convenient when repeatedly
starting from a given file when subsequent restart files have been
written. With this arrangement, the tracer restart flags can be set to
true or false, depending on whether the tracer restart data exist. With
the second option, tracer restart flags are set to ‘continue’ for all
active tracers.</p>
<p>An additional namelist option, <cite>restart_ext</cite> specifies whether halo cells
are included in the restart files. This option is useful for tripole and
regional grids, but can not be used with PIO.</p>
<p>MPI is initialized in <em>init_communicate</em> for both coupled and
stand-alone MPI runs. The ice component communicates with a flux coupler
or other climate components via external routiines that handle the
variables listed in <a class="reference internal" href="icepack_2_coupling.html#tab-flux-cpl"><span class="std std-ref">Table 1</span></a>. For stand-alone runs,
routines in <strong>ice_forcing.F90</strong> read and interpolate data from files,
and are intended merely to provide guidance for the user to write his or
her own routines. Whether the code is to be run in stand-alone or
coupled mode is determined at compile time, as described below.</p>
<p><a class="reference internal" href="#tab-ic"><span class="std std-ref">Table 4</span></a> : <em>Ice initial state resulting from combinations of</em>
<cite>ice_ic</cite>, <cite>runtype</cite> and <cite>restart</cite>. <span class="math">\(^a\)</span><em>If false, restart is reset to
true.</em> <span class="math">\(^b\)</span><em>restart is reset to false.</em> <span class="math">\(^c\)</span>ice_ic <em>is
reset to ‘none.’</em></p>
<table border="1" class="docutils" id="id2">
<span id="tab-ic"></span><caption><span class="caption-text">Table 4</span><a class="headerlink" href="#id2" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="13%" />
<col width="22%" />
<col width="32%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">ice_ic</th>
<th class="head">&#160;</th>
<th class="head">&#160;</th>
<th class="head">&#160;</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>&#160;</td>
<td>initial/false</td>
<td>initial/true</td>
<td>continue/true (or false<span class="math">\(^a\)</span>)</td>
</tr>
<tr class="row-odd"><td>none</td>
<td>no ice</td>
<td>no ice<span class="math">\(^b\)</span></td>
<td>restart using <strong>pointer_file</strong></td>
</tr>
<tr class="row-even"><td>default</td>
<td>SST/latitude dependent</td>
<td>SST/latitude dependent<span class="math">\(^b\)</span></td>
<td>restart using <strong>pointer_file</strong></td>
</tr>
<tr class="row-odd"><td><strong>filename</strong></td>
<td>no ice<span class="math">\(^c\)</span></td>
<td>start from <strong>filename</strong></td>
<td>restart using <strong>pointer_file</strong></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="choosing-an-appropriate-time-step">
<span id="parameters"></span><h2>4.4. Choosing an appropriate time step<a class="headerlink" href="#choosing-an-appropriate-time-step" title="Permalink to this headline">¶</a></h2>
<p>Transport in thickness space imposes a restraint on the time
step, given by the ice growth/melt rate and the smallest range of
thickness among the categories,
<span class="math">\(\Delta t&lt;\min(\Delta H)/2\max(f)\)</span>, where <span class="math">\(\Delta H\)</span> is the
distance between category boundaries and <span class="math">\(f\)</span> is the thermodynamic
growth rate. For the 5-category ice thickness distribution used as the
default in this distribution, this is not a stringent limitation:
<span class="math">\(\Delta t &lt; 19.4\)</span>&nbsp;hr, assuming <span class="math">\(\max(f) = 40\)</span>&nbsp;cm/day.</p>
</div>
<div class="section" id="model-output">
<h2>4.5. Model output<a class="headerlink" href="#model-output" title="Permalink to this headline">¶</a></h2>
<div class="section" id="diagnostic-files">
<span id="history"></span><h3>4.5.1. Diagnostic files<a class="headerlink" href="#diagnostic-files" title="Permalink to this headline">¶</a></h3>
<p><em>Needs specifics for icepack</em></p>
</div>
<div class="section" id="restart-files">
<h3>4.5.2. Restart files<a class="headerlink" href="#restart-files" title="Permalink to this headline">¶</a></h3>
<p>CICE now provides restart data in binary unformatted or &nbsp;formats, via
the <cite>IO_TYPE</cite> flag in <strong>comp_ice</strong> and namelist variable
<cite>restart_format</cite>. Restart and history files must use the same format. As
with the history output, there is also an option for writing parallel
restart files using PIO.</p>
<p>The restart files created by CICE contain all of the variables needed
for a full, exact restart. The filename begins with the character string
‘iced.’, and the restart dump frequency is given by the namelist
variables <cite>dumpfreq</cite> and <cite>dumpfreq_n</cite>. The pointer to the filename from
which the restart data is to be read for a continuation run is set in
<cite>pointer_file</cite>. The code assumes that auxiliary binary tracer restart
files will be identified using the same pointer and file name prefix,
but with an additional character string in the file name that is
associated with each tracer set. All variables are included in &nbsp;restart
files.</p>
<p>Additional namelist flags provide further control of restart behavior.
<cite>dump_last</cite> = true causes a set of restart files to be written at the end
of a run when it is otherwise not scheduled to occur. The flag
<cite>use_restart_time</cite> enables the user to choose to use the model date
provided in the restart files. If <cite>use_restart_time</cite> = false then the
initial model date stamp is determined from the namelist parameters.
lcdf64 = true sets 64-bit &nbsp;output, allowing larger file sizes with
version 3.</p>
<p>Routines for gathering, scattering and (unformatted) reading and writing
of the “extended” global grid, including the physical domain and ghost
(halo) cells around the outer edges, allow exact restarts on regional
grids with open boundary conditions, and they will also simplify
restarts on the various tripole grids. They are accessed by setting
<cite>restart_ext</cite> = true in namelist. Extended grid restarts are not
available when using PIO; in this case extra halo update calls fill
ghost cells for tripole grids (do not use PIO for regional grids).</p>
<p>Two restart files are included with the CICE v5 code distribution, for
the gx3 and gx1 grids. The were created using the default model
configuration (settings as in <strong>comp_ice</strong> and <strong>ice_in</strong>), but
initialized with no ice. The gx3 case was run for 1 year using the 1997
forcing data provided with the code. The gx1 case was run for 20 years,
so that the date of restart in the file is 1978-01-01. Note that the
restart dates provided in the restart files can be overridden using the
namelist variables <cite>use_restart_time</cite>, <cite>year_init</cite> and <cite>istep0</cite>. The
forcing time can also be overridden using <cite>fyear_init</cite>.</p>
</div>
</div>
<div class="section" id="execution-procedures">
<h2>4.6. Execution procedures<a class="headerlink" href="#execution-procedures" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>point to appropriate info online?*</li>
</ul>
</div>
<div class="section" id="adding-things">
<h2>4.7. Adding things<a class="headerlink" href="#adding-things" title="Permalink to this headline">¶</a></h2>
<div class="section" id="tracers">
<span id="addtrcr"></span><h3>4.7.1. Tracers<a class="headerlink" href="#tracers" title="Permalink to this headline">¶</a></h3>
<p><em>point to workflow online?</em></p>
<p>Each optional tracer has its own module, <strong>ice_[tracer].F90</strong>, which
also contains as much of the additional tracer code as possible, and for
backward compatibility of binary restart files, each new tracer has its
own binary restart file. We recommend that the logical namelist variable
<cite>tr_[tracer]</cite> be used for all calls involving the new tracer outside of
<strong>ice_[tracer].F90</strong>, in case other users do not want to use that
tracer.</p>
<p>A number of optional tracers are available in the code, including ice
age, first-year ice area, melt pond area and volume, brine height,
aerosols, and level ice area and volume (from which ridged ice
quantities are derived). Salinity, enthalpies, age, aerosols, level-ice
volume, brine height and most melt pond quantities are volume-weighted
tracers, while first-year area, pond area, level-ice area and all of the
biogeochemistry tracers in this release are area-weighted tracers. In
the absence of sources and sinks, the total mass of a volume-weighted
tracer such as aerosol (kg) is conserved under transport in horizontal
and thickness space (the mass in a given grid cell will change), whereas
the aerosol concentration (kg/m) is unchanged following the motion, and
in particular, the concentration is unchanged when there is surface or
basal melting. The proper units for a volume-weighted mass tracer in the
tracer array are kg/m.</p>
<p>In several places in the code, tracer computations must be performed on
the conserved “tracer volume” rather than the tracer itself; for
example, the conserved quantity is <span class="math">\(h_{pnd}a_{pnd}a_{lvl}a_{i}\)</span>,
not <span class="math">\(h_{pnd}\)</span>. Conserved quantities are thus computed according to
the tracer dependencies, and code must be included to account for new
dependencies (e.g., <span class="math">\(a_{lvl}\)</span> and <span class="math">\(a_{pnd}\)</span> in
<strong>ice_itd.F90</strong> and <strong>ice_mechred.F90</strong>).</p>
<p>To add a tracer, follow these steps using one of the existing tracers as
a pattern.</p>
<ol class="arabic simple">
<li><strong>ice_domain_size.F90</strong>: increase <cite>max_ntrcr</cite> (can also add option
to <strong>comp_ice</strong> and <strong>bld/Macros.*</strong>)</li>
<li><strong>ice_state.F90</strong>: declare <cite>nt_[tracer]</cite> and <cite>tr_[tracer]</cite></li>
<li><strong>ice_[tracer].F90</strong>: create initialization, physics, restart
routines</li>
<li><strong>ice_fileunits.F90</strong>: add new dump and restart file units</li>
<li><strong>ice_init.F90</strong>: (some of this may be done in <strong>ice_[tracer].F90</strong>
instead)<ul>
<li>add new module and <cite>tr_[tracer]</cite> to list of used modules and
variables</li>
<li>add logical namelist variable <cite>tr_[tracer]</cite></li>
<li>initialize namelist variable</li>
<li>broadcast namelist variable</li>
<li>print namelist variable to diagnostic output file</li>
<li>increment number of tracers in use based on namelist input (<cite>ntrcr</cite>)</li>
<li>define tracer types (<cite>trcr_depend</cite> = 0 for ice area tracers, 1 for
ice volume, 2 for snow volume, 2+nt_[tracer] for dependence on
other tracers)</li>
</ul>
</li>
<li><strong>ice_itd.F90</strong>, <strong>ice_mechred.F90</strong>: Account for new dependencies
if needed.</li>
<li><strong>CICE_InitMod.F90</strong>: initialize tracer (includes reading restart
file)</li>
<li><strong>CICE_RunMod.F90</strong>, <strong>ice_step_mod.F90</strong>:<ul>
<li>call routine to write tracer restart data</li>
<li>call physics routines in <strong>ice_[tracer].F90</strong> (often called from
<strong>ice_step_mod.F90</strong>)</li>
</ul>
</li>
<li><strong>ice_restart.F90</strong>: define restart variables (for binary, &nbsp;and PIO)</li>
<li><strong>ice_history_[tracer].F90</strong>: add history variables</li>
<li><strong>ice_in</strong>: add namelist variables to <em>tracer_nml</em> and
<em>icefields_nml</em></li>
<li>If strict conservation is necessary, add diagnostics as noted for
topo ponds in Section&nbsp;<a class="reference internal" href="icepack_3_model_components.html#ponds"><span class="std std-ref">Melt ponds</span></a>.</li>
</ol>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="icepack_5_troubleshooting.html" title="5. Troubleshooting"
             >next</a></li>
        <li class="right" >
          <a href="icepack_3_model_components.html" title="3. Model components"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">CICE-Consortium Icepack 0.0.1 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, Los Alamos National Security, LLC (code) and National Center for Atmospheric Research (documentation).
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.3.
    </div>
  </body>
</html>